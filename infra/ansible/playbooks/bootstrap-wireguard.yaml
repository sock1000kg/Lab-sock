# RUN THIS WITH THE BOOTSTRAP INVENTORY
---
- name: Configure Common Layer
  hosts: all
  become: true
  roles:
    - common

- name: Configure Cloud Gateway
  hosts: cloud
  become: true
  vars:
    # Run umask 077 wg genkey | tee /etc/wireguard/privatekey | wg pubkey > /etc/wireguard/publickey to generate key
    dell_laptop_public_key: "vlw1OCbAP++PohLTJG71NLNJfwfPiOzb/NyGOY92tW0="
    laptop_public_key: "JiSzjW0rgUrGg/TsIZA2mpPgJGFFzonaHfu+tJAk00U="
  roles:
    - wireguard-hub

- name: Configure Home Server
  hosts: metal
  become: true
  vars:
    # Get IP from cloud host dynamically cus it changes whenever I spin up PIP (reduce cost)
    hub_endpoint_ip: "{{ hostvars[groups['cloud'][0]]['ansible_host'] }}"
    hub_public_key: "{{ hostvars[groups['cloud'][0]]['hub_public_key_fact'] }}"
  roles:
    - wireguard-client
